generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model guilds {
  created     DateTime      @default(now()) @db.Timestamp(0)
  guild_id    String        @id @db.Char(18)
  logs        logs[]
  permissions permissions[]
  warnings    warnings[]
  whitelist   whitelist[]
}

model logs {
  uuid       String         @id(map: "logs_pk") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  event_type logs_eventType
  user       String?        @db.Char(18)
  target     String?        @db.Char(18)
  created    DateTime       @default(now()) @db.Timestamp(0)
  guild_id   String         @db.Char(18)
  content    String?        @db.VarChar(254)
  guilds     guilds         @relation(fields: [guild_id], references: [guild_id], onDelete: Cascade, onUpdate: Restrict)

  @@index([guild_id], map: "logs_FK")
}

model permissions {
  guild_id   String           @db.Char(18)
  command_id String           @db.Char(18)
  created    DateTime         @default(now()) @db.Timestamp(0)
  type       permissions_type
  permission Boolean
  uuid       String           @id(map: "permissions_pk") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  guilds     guilds           @relation(fields: [guild_id], references: [guild_id], onDelete: Cascade, onUpdate: Restrict)

  @@index([guild_id], map: "permissions_FK")
}

model sessions {
  session_id    String   @id(map: "sessions_pk") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  created       DateTime @default(now()) @db.Timestamp(0)
  user_id       String   @db.Char(18)
  access_token  String   @db.Char(30)
  refresh_token String   @db.Char(30)
  expire        DateTime @db.Timestamp(6)
}

model warnings {
  uuid      String   @id(map: "warnings_pk") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  created   DateTime @default(now()) @db.Timestamp(0)
  guild_id  String   @db.Char(18)
  target_id String   @db.Char(18)
  mod_id    String   @db.Char(18)
  reason    String   @db.VarChar(256)
  guilds    guilds   @relation(fields: [guild_id], references: [guild_id], onDelete: Cascade, onUpdate: Restrict, map: "warnings_FK")

  @@index([guild_id], map: "Warnings_FK")
}

model rcon {
  guild_id String  @id(map: "rcon_pk") @db.VarChar(18)
  host     String  @db.VarChar(32)
  port     Int
  password String  @db.VarChar(64)
  role_id  String? @db.VarChar(18)
}

model whitelist {
  guild_id String   @db.Char(18)
  created  DateTime @default(now()) @db.Timestamp(0)
  mc_uuid  String   @db.Char(32)
  user_id  String   @db.Char(18)
  uuid     String   @id(map: "whitelist_pk") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid

  guilds guilds @relation(fields: [guild_id], references: [guild_id])


  @@unique([guild_id, user_id], name: "whitelist_guild_user_un")
  @@unique([guild_id, mc_uuid], name: "whitelist_guild_uuid_un")
}

enum logs_eventType {
  warn
  del_warn
  ban
  kick
  message_delete
  message_update
}

enum permissions_type {
  USER
  ROLE
}
